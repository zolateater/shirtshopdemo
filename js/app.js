function CanvasSurface(t){if(!(t instanceof HTMLCanvasElement))throw new TypeError("Passed canvas is not HTMLCanvasElement!");this.canvas=t,this.context=t.getContext("2d"),this.factory=new CanvasUIFactory(this.context),this.elements=new UICollection,this.elements.add(this.factory.createLabel()),this.eventHandler=new CanvasSurfaceEventHandler(this),this.eventHandler.bindHtmlCanvasEvents(),this._isExportingRender=!1,this.clearColor="#FFFFFF"}function CanvasSurfaceEventHandler(t){this.surface=t,this.isMouseDown=!1,this.isMovingClick=!1,this.isResizingClick=!1,this.lastClickOffset=null,this.lastResizeCoordinates=null,this.handlers={onSelect:[],onDeselect:[]}}function CanvasUIElementView(t){if(!(t instanceof CanvasRenderingContext2D))throw new TypeError("Canvas UI Element View error! Context is not a context");this.context=t}function CanvasUIFactory(t){if(!(t instanceof CanvasRenderingContext2D))throw new TypeError("Canvas rendering context must be instance of CanvasRenderingContext2D! (factory creating)");this.context=t}function CanvasUIImageView(t){CanvasUIElementView.call(this,t)}function CanvasUILabelView(t){CanvasUIElementView.call(this,t)}function CanvasUISelectedView(t,e){if(!(t instanceof CanvasRenderingContext2D))throw new TypeError("Canvas UI Element View error! Context does not have type CanvasRenderingContext2D!");this.context=t,this.fillStyle=e.color||"#AAAAAA",this.resizeIconWidth=e.size||15}function Position(t,e){this.x=+t||0,this.y=+e||0}function ResourceLoader(){}function ResourcePreparer(t,e,n){this.loader=t,this.resourcesToLoad=e,this.onLoad=n}function Size(t,e){this.width=+t||Size.defaultWidth,this.height=+e||Size.defaultHeight}function Storage(){throw new TypeError("This is not for creating objects!")}function UICollection(){var t=this;this.elements=[],this.selectedIndex=-1,Object.defineProperty(this,"length",{get:function(){return t.elements.length}})}function UIElement(t,e){t instanceof Position||(t=new Position),this.position=t,e instanceof Position||(e=new Size),this.size=e}function UIElementView(){}function UIImageElement(t,e,n){if(UIElement.call(this,t,e),!(n instanceof Image))throw new TypeError("Image must have Image type!");this.image=n}function UILabelElement(t,e,n,a){UIElement.apply(this,[t,e]),n||(n=UILabelElement.defaultText),this.text=n,a instanceof Object||(a={}),this.font=a.font||UILabelElement.defaultStyle.font,this.color=a.color||UILabelElement.defaultStyle.color}function Camera(){this.angleTheta=30,this.angleFi=0,this.distance=15,this.minAngleTheta=10,this.maxAngleTheta=170,this.position=this.getNewPosition(),this.lookAt=[0,0,1.3],this.up=[0,0,1],this.matrix=new Float32Array(16),this.updateMatrix()}function Model(t,e){this.buildBuffers(t,e)}function ModelView(t,e,n,a,o){this.canvas=t,this.gl=e,this.texture=n,this.clearColor={r:.9,g:.9,b:.9,a:1},this.initialize(a,o),this.camera=new Camera,this.setTexture(n)}function ShaderCompiler(t){this.webGLContext=t}function ComponentsPanel(t,e){this._surface=t,this._fileInput=document.getElementById("fileUploader"),this._btnUpdateTexture=document.getElementById("updateTexture"),this._btnAddText=document.getElementById("btnAddText"),this._selectBackground=document.getElementById("selectBackground"),this._modelView=e}function ModelViewPanel(t,e){this._btnZoomIn=document.getElementById("btnZoomIn"),this._btnZoomOut=document.getElementById("btnZoomOut"),this._cupTypeSelect=document.getElementById("cupTypeSelect"),this._modelView=t,this._models=e}function PreviewPanel(t){this.modelView=t,this.panel=document.getElementById("previewPanel"),this.canvas=document.getElementById("previewCanvas"),this._btnToggle=document.getElementById("btnTogglePreview"),this.isShown=!1}function PropertiesPanel(t){this._textPanel={panel:document.getElementById("textOptions"),selectFont:document.getElementById("fontSelect"),selectColor:document.getElementById("colorFontSelect"),textArea:document.getElementById("selectedTextContent"),textUpButton:document.getElementById("textUpBtn"),textDownButton:document.getElementById("textDownBtn")},this._commonPanel={panel:document.getElementById("commonOptions"),removeBtn:document.getElementById("removeBtn"),upBtn:document.getElementById("upBtn"),downBtn:document.getElementById("downBtn")},this._imagePanel={panel:document.getElementById("imageOptions")},this._emptyPanel=document.getElementById("noSelectedOptions"),this._selectedElement=null,this._surface=t}!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var a in n)("object"==typeof exports?exports:t)[a]=n[a]}}(this,function(){return function(t){function e(a){if(n[a])return n[a].exports;var o=n[a]={exports:{},id:a,loaded:!1};return t[a].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){e.glMatrix=n(1),e.mat2=n(2),e.mat2d=n(3),e.mat3=n(4),e.mat4=n(5),e.quat=n(6),e.vec2=n(9),e.vec3=n(7),e.vec4=n(8)},function(t,e){var n={};n.EPSILON=1e-6,n.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,n.RANDOM=Math.random,n.ENABLE_SIMD=!1,n.SIMD_AVAILABLE=n.ARRAY_TYPE===Float32Array&&"SIMD"in this,n.USE_SIMD=n.ENABLE_SIMD&&n.SIMD_AVAILABLE,n.setMatrixArrayType=function(t){n.ARRAY_TYPE=t};var a=Math.PI/180;n.toRadian=function(t){return t*a},n.equals=function(t,e){return Math.abs(t-e)<=n.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},t.exports=n},function(t,e,n){var a=n(1),o={};o.create=function(){var t=new a.ARRAY_TYPE(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},o.clone=function(t){var e=new a.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},o.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},o.fromValues=function(t,e,n,o){var r=new a.ARRAY_TYPE(4);return r[0]=t,r[1]=e,r[2]=n,r[3]=o,r},o.set=function(t,e,n,a,o){return t[0]=e,t[1]=n,t[2]=a,t[3]=o,t},o.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},o.invert=function(t,e){var n=e[0],a=e[1],o=e[2],r=e[3],i=n*r-o*a;return i?(i=1/i,t[0]=r*i,t[1]=-a*i,t[2]=-o*i,t[3]=n*i,t):null},o.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},o.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},o.multiply=function(t,e,n){var a=e[0],o=e[1],r=e[2],i=e[3],s=n[0],l=n[1],u=n[2],c=n[3];return t[0]=a*s+r*l,t[1]=o*s+i*l,t[2]=a*u+r*c,t[3]=o*u+i*c,t},o.mul=o.multiply,o.rotate=function(t,e,n){var a=e[0],o=e[1],r=e[2],i=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=a*l+r*s,t[1]=o*l+i*s,t[2]=a*-s+r*l,t[3]=o*-s+i*l,t},o.scale=function(t,e,n){var a=e[0],o=e[1],r=e[2],i=e[3],s=n[0],l=n[1];return t[0]=a*s,t[1]=o*s,t[2]=r*l,t[3]=i*l,t},o.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=-n,t[3]=a,t},o.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},o.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},o.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},o.LDU=function(t,e,n,a){return t[2]=a[2]/a[0],n[0]=a[0],n[1]=a[1],n[3]=a[3]-t[2]*n[1],[t,e,n]},o.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},o.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t},o.sub=o.subtract,o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},o.equals=function(t,e){var n=t[0],o=t[1],r=t[2],i=t[3],s=e[0],l=e[1],u=e[2],c=e[3];return Math.abs(n-s)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(o-l)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(r-u)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-c)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))},o.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},o.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t},t.exports=o},function(t,e,n){var a=n(1),o={};o.create=function(){var t=new a.ARRAY_TYPE(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},o.clone=function(t){var e=new a.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},o.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},o.fromValues=function(t,e,n,o,r,i){var s=new a.ARRAY_TYPE(6);return s[0]=t,s[1]=e,s[2]=n,s[3]=o,s[4]=r,s[5]=i,s},o.set=function(t,e,n,a,o,r,i){return t[0]=e,t[1]=n,t[2]=a,t[3]=o,t[4]=r,t[5]=i,t},o.invert=function(t,e){var n=e[0],a=e[1],o=e[2],r=e[3],i=e[4],s=e[5],l=n*r-a*o;return l?(l=1/l,t[0]=r*l,t[1]=-a*l,t[2]=-o*l,t[3]=n*l,t[4]=(o*s-r*i)*l,t[5]=(a*i-n*s)*l,t):null},o.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},o.multiply=function(t,e,n){var a=e[0],o=e[1],r=e[2],i=e[3],s=e[4],l=e[5],u=n[0],c=n[1],h=n[2],d=n[3],f=n[4],M=n[5];return t[0]=a*u+r*c,t[1]=o*u+i*c,t[2]=a*h+r*d,t[3]=o*h+i*d,t[4]=a*f+r*M+s,t[5]=o*f+i*M+l,t},o.mul=o.multiply,o.rotate=function(t,e,n){var a=e[0],o=e[1],r=e[2],i=e[3],s=e[4],l=e[5],u=Math.sin(n),c=Math.cos(n);return t[0]=a*c+r*u,t[1]=o*c+i*u,t[2]=a*-u+r*c,t[3]=o*-u+i*c,t[4]=s,t[5]=l,t},o.scale=function(t,e,n){var a=e[0],o=e[1],r=e[2],i=e[3],s=e[4],l=e[5],u=n[0],c=n[1];return t[0]=a*u,t[1]=o*u,t[2]=r*c,t[3]=i*c,t[4]=s,t[5]=l,t},o.translate=function(t,e,n){var a=e[0],o=e[1],r=e[2],i=e[3],s=e[4],l=e[5],u=n[0],c=n[1];return t[0]=a,t[1]=o,t[2]=r,t[3]=i,t[4]=a*u+r*c+s,t[5]=o*u+i*c+l,t},o.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=-n,t[3]=a,t[4]=0,t[5]=0,t},o.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},o.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},o.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},o.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},o.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},o.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t},o.sub=o.subtract,o.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},o.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t},o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},o.equals=function(t,e){var n=t[0],o=t[1],r=t[2],i=t[3],s=t[4],l=t[5],u=e[0],c=e[1],h=e[2],d=e[3],f=e[4],M=e[5];return Math.abs(n-u)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(o-c)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(r-h)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-d)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(s-f)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(l-M)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(M))},t.exports=o},function(t,e,n){var a=n(1),o={};o.create=function(){var t=new a.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},o.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},o.clone=function(t){var e=new a.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},o.fromValues=function(t,e,n,o,r,i,s,l,u){var c=new a.ARRAY_TYPE(9);return c[0]=t,c[1]=e,c[2]=n,c[3]=o,c[4]=r,c[5]=i,c[6]=s,c[7]=l,c[8]=u,c},o.set=function(t,e,n,a,o,r,i,s,l,u){return t[0]=e,t[1]=n,t[2]=a,t[3]=o,t[4]=r,t[5]=i,t[6]=s,t[7]=l,t[8]=u,t},o.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},o.transpose=function(t,e){if(t===e){var n=e[1],a=e[2],o=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=a,t[7]=o}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},o.invert=function(t,e){var n=e[0],a=e[1],o=e[2],r=e[3],i=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=c*i-s*u,d=-c*r+s*l,f=u*r-i*l,M=n*h+a*d+o*f;return M?(M=1/M,t[0]=h*M,t[1]=(-c*a+o*u)*M,t[2]=(s*a-o*i)*M,t[3]=d*M,t[4]=(c*n-o*l)*M,t[5]=(-s*n+o*r)*M,t[6]=f*M,t[7]=(-u*n+a*l)*M,t[8]=(i*n-a*r)*M,t):null},o.adjoint=function(t,e){var n=e[0],a=e[1],o=e[2],r=e[3],i=e[4],s=e[5],l=e[6],u=e[7],c=e[8];return t[0]=i*c-s*u,t[1]=o*u-a*c,t[2]=a*s-o*i,t[3]=s*l-r*c,t[4]=n*c-o*l,t[5]=o*r-n*s,t[6]=r*u-i*l,t[7]=a*l-n*u,t[8]=n*i-a*r,t},o.determinant=function(t){var e=t[0],n=t[1],a=t[2],o=t[3],r=t[4],i=t[5],s=t[6],l=t[7],u=t[8];return e*(u*r-i*l)+n*(-u*o+i*s)+a*(l*o-r*s)},o.multiply=function(t,e,n){var a=e[0],o=e[1],r=e[2],i=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=n[0],f=n[1],M=n[2],m=n[3],I=n[4],S=n[5],x=n[6],v=n[7],p=n[8];return t[0]=d*a+f*i+M*u,t[1]=d*o+f*s+M*c,t[2]=d*r+f*l+M*h,t[3]=m*a+I*i+S*u,t[4]=m*o+I*s+S*c,t[5]=m*r+I*l+S*h,t[6]=x*a+v*i+p*u,t[7]=x*o+v*s+p*c,t[8]=x*r+v*l+p*h,t},o.mul=o.multiply,o.translate=function(t,e,n){var a=e[0],o=e[1],r=e[2],i=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=n[0],f=n[1];return t[0]=a,t[1]=o,t[2]=r,t[3]=i,t[4]=s,t[5]=l,t[6]=d*a+f*i+u,t[7]=d*o+f*s+c,t[8]=d*r+f*l+h,t},o.rotate=function(t,e,n){var a=e[0],o=e[1],r=e[2],i=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=Math.sin(n),f=Math.cos(n);return t[0]=f*a+d*i,t[1]=f*o+d*s,t[2]=f*r+d*l,t[3]=f*i-d*a,t[4]=f*s-d*o,t[5]=f*l-d*r,t[6]=u,t[7]=c,t[8]=h,t},o.scale=function(t,e,n){var a=n[0],o=n[1];return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=o*e[3],t[4]=o*e[4],t[5]=o*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},o.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},o.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=0,t[3]=-n,t[4]=a,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},o.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},o.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},o.fromQuat=function(t,e){var n=e[0],a=e[1],o=e[2],r=e[3],i=n+n,s=a+a,l=o+o,u=n*i,c=a*i,h=a*s,d=o*i,f=o*s,M=o*l,m=r*i,I=r*s,S=r*l;return t[0]=1-h-M,t[3]=c-S,t[6]=d+I,t[1]=c+S,t[4]=1-u-M,t[7]=f-m,t[2]=d-I,t[5]=f+m,t[8]=1-u-h,t},o.normalFromMat4=function(t,e){var n=e[0],a=e[1],o=e[2],r=e[3],i=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],M=e[12],m=e[13],I=e[14],S=e[15],x=n*s-a*i,v=n*l-o*i,p=n*u-r*i,g=a*l-o*s,D=a*u-r*s,F=o*u-r*l,E=c*m-h*M,w=c*I-d*M,b=c*S-f*M,y=h*I-d*m,P=h*S-f*m,R=d*S-f*I,L=x*R-v*P+p*y+g*b-D*w+F*E;return L?(L=1/L,t[0]=(s*R-l*P+u*y)*L,t[1]=(l*b-i*R-u*w)*L,t[2]=(i*P-s*b+u*E)*L,t[3]=(o*P-a*R-r*y)*L,t[4]=(n*R-o*b+r*w)*L,t[5]=(a*b-n*P-r*E)*L,t[6]=(m*F-I*D+S*g)*L,t[7]=(I*p-M*F-S*v)*L,t[8]=(M*D-m*p+S*x)*L,t):null},o.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},o.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},o.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},o.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t},o.sub=o.subtract,o.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},o.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t[6]=e[6]+n[6]*a,t[7]=e[7]+n[7]*a,t[8]=e[8]+n[8]*a,t},o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},o.equals=function(t,e){var n=t[0],o=t[1],r=t[2],i=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=e[0],f=e[1],M=e[2],m=e[3],I=e[4],S=e[5],x=t[6],v=e[7],p=e[8];return Math.abs(n-d)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-f)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(r-M)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(M))&&Math.abs(i-m)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(s-I)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(I))&&Math.abs(l-S)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(u-x)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(x))&&Math.abs(c-v)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(h-p)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(p))},t.exports=o},function(t,e,n){var a=n(1),o={scalar:{},SIMD:{}};o.create=function(){var t=new a.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.clone=function(t){var e=new a.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},o.fromValues=function(t,e,n,o,r,i,s,l,u,c,h,d,f,M,m,I){var S=new a.ARRAY_TYPE(16);return S[0]=t,S[1]=e,S[2]=n,S[3]=o,S[4]=r,S[5]=i,S[6]=s,S[7]=l,S[8]=u,S[9]=c,S[10]=h,S[11]=d,S[12]=f,S[13]=M,S[14]=m,S[15]=I,S},o.set=function(t,e,n,a,o,r,i,s,l,u,c,h,d,f,M,m,I){return t[0]=e,t[1]=n,t[2]=a,t[3]=o,t[4]=r,t[5]=i,t[6]=s,t[7]=l,t[8]=u,t[9]=c,t[10]=h,t[11]=d,t[12]=f,t[13]=M,t[14]=m,t[15]=I,t},o.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.scalar.transpose=function(t,e){if(t===e){var n=e[1],a=e[2],o=e[3],r=e[6],i=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=a,t[9]=r,t[11]=e[14],t[12]=o,t[13]=i,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},o.SIMD.transpose=function(t,e){var n,a,o,r,i,s,l,u,c,h;return n=SIMD.Float32x4.load(e,0),a=SIMD.Float32x4.load(e,4),o=SIMD.Float32x4.load(e,8),r=SIMD.Float32x4.load(e,12),i=SIMD.Float32x4.shuffle(n,a,0,1,4,5),s=SIMD.Float32x4.shuffle(o,r,0,1,4,5),l=SIMD.Float32x4.shuffle(i,s,0,2,4,6),u=SIMD.Float32x4.shuffle(i,s,1,3,5,7),SIMD.Float32x4.store(t,0,l),SIMD.Float32x4.store(t,4,u),i=SIMD.Float32x4.shuffle(n,a,2,3,6,7),s=SIMD.Float32x4.shuffle(o,r,2,3,6,7),c=SIMD.Float32x4.shuffle(i,s,0,2,4,6),h=SIMD.Float32x4.shuffle(i,s,1,3,5,7),SIMD.Float32x4.store(t,8,c),SIMD.Float32x4.store(t,12,h),t},o.transpose=a.USE_SIMD?o.SIMD.transpose:o.scalar.transpose,o.scalar.invert=function(t,e){var n=e[0],a=e[1],o=e[2],r=e[3],i=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],M=e[12],m=e[13],I=e[14],S=e[15],x=n*s-a*i,v=n*l-o*i,p=n*u-r*i,g=a*l-o*s,D=a*u-r*s,F=o*u-r*l,E=c*m-h*M,w=c*I-d*M,b=c*S-f*M,y=h*I-d*m,P=h*S-f*m,R=d*S-f*I,L=x*R-v*P+p*y+g*b-D*w+F*E;return L?(L=1/L,t[0]=(s*R-l*P+u*y)*L,t[1]=(o*P-a*R-r*y)*L,t[2]=(m*F-I*D+S*g)*L,t[3]=(d*D-h*F-f*g)*L,t[4]=(l*b-i*R-u*w)*L,t[5]=(n*R-o*b+r*w)*L,t[6]=(I*p-M*F-S*v)*L,t[7]=(c*F-d*p+f*v)*L,t[8]=(i*P-s*b+u*E)*L,t[9]=(a*b-n*P-r*E)*L,t[10]=(M*D-m*p+S*x)*L,t[11]=(h*p-c*D-f*x)*L,t[12]=(s*w-i*y-l*E)*L,t[13]=(n*y-a*w+o*E)*L,t[14]=(m*v-M*g-I*x)*L,t[15]=(c*g-h*v+d*x)*L,t):null},o.SIMD.invert=function(t,e){var n,a,o,r,i,s,l,u,c,h,d=SIMD.Float32x4.load(e,0),f=SIMD.Float32x4.load(e,4),M=SIMD.Float32x4.load(e,8),m=SIMD.Float32x4.load(e,12);return i=SIMD.Float32x4.shuffle(d,f,0,1,4,5),a=SIMD.Float32x4.shuffle(M,m,0,1,4,5),n=SIMD.Float32x4.shuffle(i,a,0,2,4,6),a=SIMD.Float32x4.shuffle(a,i,1,3,5,7),i=SIMD.Float32x4.shuffle(d,f,2,3,6,7),r=SIMD.Float32x4.shuffle(M,m,2,3,6,7),o=SIMD.Float32x4.shuffle(i,r,0,2,4,6),r=SIMD.Float32x4.shuffle(r,i,1,3,5,7),i=SIMD.Float32x4.mul(o,r),i=SIMD.Float32x4.swizzle(i,1,0,3,2),s=SIMD.Float32x4.mul(a,i),l=SIMD.Float32x4.mul(n,i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),s=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,i),s),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,i),l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),i=SIMD.Float32x4.mul(a,o),i=SIMD.Float32x4.swizzle(i,1,0,3,2),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,i),s),c=SIMD.Float32x4.mul(n,i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(r,i)),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,i),c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),i=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(a,2,3,0,1),r),i=SIMD.Float32x4.swizzle(i,1,0,3,2),o=SIMD.Float32x4.swizzle(o,2,3,0,1),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,i),s),u=SIMD.Float32x4.mul(n,i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(o,i)),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,i),u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),i=SIMD.Float32x4.mul(n,a),i=SIMD.Float32x4.swizzle(i,1,0,3,2),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,i),u),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,i),c),i=SIMD.Float32x4.swizzle(i,2,3,0,1),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,i),u),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(o,i)),i=SIMD.Float32x4.mul(n,r),i=SIMD.Float32x4.swizzle(i,1,0,3,2),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(o,i)),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,i),u),i=SIMD.Float32x4.swizzle(i,2,3,0,1),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,i),l),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(a,i)),i=SIMD.Float32x4.mul(n,o),i=SIMD.Float32x4.swizzle(i,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,i),l),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(a,i)),i=SIMD.Float32x4.swizzle(i,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(r,i)),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,i),c),h=SIMD.Float32x4.mul(n,s),h=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(h,2,3,0,1),h),h=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(h,1,0,3,2),h),i=SIMD.Float32x4.reciprocalApproximation(h),h=SIMD.Float32x4.sub(SIMD.Float32x4.add(i,i),SIMD.Float32x4.mul(h,SIMD.Float32x4.mul(i,i))),(h=SIMD.Float32x4.swizzle(h,0,0,0,0))?(SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(h,s)),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(h,l)),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(h,u)),SIMD.Float32x4.store(t,12,SIMD.Float32x4.mul(h,c)),t):null},o.invert=a.USE_SIMD?o.SIMD.invert:o.scalar.invert,o.scalar.adjoint=function(t,e){var n=e[0],a=e[1],o=e[2],r=e[3],i=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],M=e[12],m=e[13],I=e[14],S=e[15];return t[0]=s*(d*S-f*I)-h*(l*S-u*I)+m*(l*f-u*d),t[1]=-(a*(d*S-f*I)-h*(o*S-r*I)+m*(o*f-r*d)),t[2]=a*(l*S-u*I)-s*(o*S-r*I)+m*(o*u-r*l),t[3]=-(a*(l*f-u*d)-s*(o*f-r*d)+h*(o*u-r*l)),t[4]=-(i*(d*S-f*I)-c*(l*S-u*I)+M*(l*f-u*d)),t[5]=n*(d*S-f*I)-c*(o*S-r*I)+M*(o*f-r*d),t[6]=-(n*(l*S-u*I)-i*(o*S-r*I)+M*(o*u-r*l)),t[7]=n*(l*f-u*d)-i*(o*f-r*d)+c*(o*u-r*l),t[8]=i*(h*S-f*m)-c*(s*S-u*m)+M*(s*f-u*h),t[9]=-(n*(h*S-f*m)-c*(a*S-r*m)+M*(a*f-r*h)),t[10]=n*(s*S-u*m)-i*(a*S-r*m)+M*(a*u-r*s),t[11]=-(n*(s*f-u*h)-i*(a*f-r*h)+c*(a*u-r*s)),t[12]=-(i*(h*I-d*m)-c*(s*I-l*m)+M*(s*d-l*h)),t[13]=n*(h*I-d*m)-c*(a*I-o*m)+M*(a*d-o*h),t[14]=-(n*(s*I-l*m)-i*(a*I-o*m)+M*(a*l-o*s)),t[15]=n*(s*d-l*h)-i*(a*d-o*h)+c*(a*l-o*s),t},o.SIMD.adjoint=function(t,e){var n,a,o,r,i,s,l,u,c,h,d,f,M,n=SIMD.Float32x4.load(e,0),a=SIMD.Float32x4.load(e,4),o=SIMD.Float32x4.load(e,8),r=SIMD.Float32x4.load(e,12);return c=SIMD.Float32x4.shuffle(n,a,0,1,4,5),s=SIMD.Float32x4.shuffle(o,r,0,1,4,5),i=SIMD.Float32x4.shuffle(c,s,0,2,4,6),s=SIMD.Float32x4.shuffle(s,c,1,3,5,7),c=SIMD.Float32x4.shuffle(n,a,2,3,6,7),u=SIMD.Float32x4.shuffle(o,r,2,3,6,7),l=SIMD.Float32x4.shuffle(c,u,0,2,4,6),u=SIMD.Float32x4.shuffle(u,c,1,3,5,7),c=SIMD.Float32x4.mul(l,u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),h=SIMD.Float32x4.mul(s,c),d=SIMD.Float32x4.mul(i,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,c),h),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,c),d),d=SIMD.Float32x4.swizzle(d,2,3,0,1),c=SIMD.Float32x4.mul(s,l),c=SIMD.Float32x4.swizzle(c,1,0,3,2),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),h),M=SIMD.Float32x4.mul(i,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(u,c)),M=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,c),M),M=SIMD.Float32x4.swizzle(M,2,3,0,1),c=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,3,0,1),u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),l=SIMD.Float32x4.swizzle(l,2,3,0,1),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,c),h),f=SIMD.Float32x4.mul(i,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(l,c)),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,c),f),f=SIMD.Float32x4.swizzle(f,2,3,0,1),c=SIMD.Float32x4.mul(i,s),c=SIMD.Float32x4.swizzle(c,1,0,3,2),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),f),M=SIMD.Float32x4.sub(SIMD.Float32x4.mul(l,c),M),c=SIMD.Float32x4.swizzle(c,2,3,0,1),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(u,c),f),M=SIMD.Float32x4.sub(M,SIMD.Float32x4.mul(l,c)),c=SIMD.Float32x4.mul(i,u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(l,c)),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,c),f),c=SIMD.Float32x4.swizzle(c,2,3,0,1),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,c),d),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(s,c)),c=SIMD.Float32x4.mul(i,l),c=SIMD.Float32x4.swizzle(c,1,0,3,2),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),d),M=SIMD.Float32x4.sub(M,SIMD.Float32x4.mul(s,c)),c=SIMD.Float32x4.swizzle(c,2,3,0,1),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(u,c)),M=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,c),M),SIMD.Float32x4.store(t,0,h),SIMD.Float32x4.store(t,4,d),SIMD.Float32x4.store(t,8,f),SIMD.Float32x4.store(t,12,M),t},o.adjoint=a.USE_SIMD?o.SIMD.adjoint:o.scalar.adjoint,o.determinant=function(t){var e=t[0],n=t[1],a=t[2],o=t[3],r=t[4],i=t[5],s=t[6],l=t[7],u=t[8],c=t[9],h=t[10],d=t[11],f=t[12],M=t[13],m=t[14],I=t[15],S=e*i-n*r,x=e*s-a*r,v=e*l-o*r,p=n*s-a*i,g=n*l-o*i,D=a*l-o*s,F=u*M-c*f,E=u*m-h*f,w=u*I-d*f,b=c*m-h*M,y=c*I-d*M,P=h*I-d*m;return S*P-x*y+v*b+p*w-g*E+D*F},o.SIMD.multiply=function(t,e,n){var a=SIMD.Float32x4.load(e,0),o=SIMD.Float32x4.load(e,4),r=SIMD.Float32x4.load(e,8),i=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4.load(n,0),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,0,0,0,0),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,1,1,1,1),o),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,2,2,2),r),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,3,3,3,3),i))));SIMD.Float32x4.store(t,0,l);var u=SIMD.Float32x4.load(n,4),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,0,0,0,0),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,1,1,1,1),o),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,2,2,2,2),r),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,3,3,3,3),i))));SIMD.Float32x4.store(t,4,c);var h=SIMD.Float32x4.load(n,8),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),o),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),r),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),i))));SIMD.Float32x4.store(t,8,d);var f=SIMD.Float32x4.load(n,12),M=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,0,0,0,0),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,1,1,1,1),o),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,2,2,2,2),r),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,3,3,3,3),i))));return SIMD.Float32x4.store(t,12,M),t},o.scalar.multiply=function(t,e,n){var a=e[0],o=e[1],r=e[2],i=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=e[9],f=e[10],M=e[11],m=e[12],I=e[13],S=e[14],x=e[15],v=n[0],p=n[1],g=n[2],D=n[3];return t[0]=v*a+p*s+g*h+D*m,t[1]=v*o+p*l+g*d+D*I,t[2]=v*r+p*u+g*f+D*S,t[3]=v*i+p*c+g*M+D*x,v=n[4],p=n[5],g=n[6],D=n[7],t[4]=v*a+p*s+g*h+D*m,t[5]=v*o+p*l+g*d+D*I,t[6]=v*r+p*u+g*f+D*S,t[7]=v*i+p*c+g*M+D*x,v=n[8],p=n[9],g=n[10],D=n[11],t[8]=v*a+p*s+g*h+D*m,t[9]=v*o+p*l+g*d+D*I,t[10]=v*r+p*u+g*f+D*S,t[11]=v*i+p*c+g*M+D*x,v=n[12],p=n[13],g=n[14],D=n[15],t[12]=v*a+p*s+g*h+D*m,t[13]=v*o+p*l+g*d+D*I,t[14]=v*r+p*u+g*f+D*S,t[15]=v*i+p*c+g*M+D*x,t},o.multiply=a.USE_SIMD?o.SIMD.multiply:o.scalar.multiply,o.mul=o.multiply,o.scalar.translate=function(t,e,n){var a,o,r,i,s,l,u,c,h,d,f,M,m=n[0],I=n[1],S=n[2];return e===t?(t[12]=e[0]*m+e[4]*I+e[8]*S+e[12],t[13]=e[1]*m+e[5]*I+e[9]*S+e[13],t[14]=e[2]*m+e[6]*I+e[10]*S+e[14],t[15]=e[3]*m+e[7]*I+e[11]*S+e[15]):(a=e[0],o=e[1],r=e[2],i=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=e[9],f=e[10],M=e[11],t[0]=a,t[1]=o,t[2]=r,t[3]=i,t[4]=s,t[5]=l,t[6]=u,t[7]=c,t[8]=h,t[9]=d,t[10]=f,t[11]=M,t[12]=a*m+s*I+h*S+e[12],t[13]=o*m+l*I+d*S+e[13],t[14]=r*m+u*I+f*S+e[14],t[15]=i*m+c*I+M*S+e[15]),t},o.SIMD.translate=function(t,e,n){var a=SIMD.Float32x4.load(e,0),o=SIMD.Float32x4.load(e,4),r=SIMD.Float32x4.load(e,8),i=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4(n[0],n[1],n[2],0);e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11]),a=SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(s,0,0,0,0)),o=SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(s,1,1,1,1)),r=SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(s,2,2,2,2));var l=SIMD.Float32x4.add(a,SIMD.Float32x4.add(o,SIMD.Float32x4.add(r,i)));return SIMD.Float32x4.store(t,12,l),t},o.translate=a.USE_SIMD?o.SIMD.translate:o.scalar.translate,o.scalar.scale=function(t,e,n){var a=n[0],o=n[1],r=n[2];return t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},o.SIMD.scale=function(t,e,n){var a,o,r,i=SIMD.Float32x4(n[0],n[1],n[2],0);return a=SIMD.Float32x4.load(e,0),SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(i,0,0,0,0))),o=SIMD.Float32x4.load(e,4),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(i,1,1,1,1))),r=SIMD.Float32x4.load(e,8),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(i,2,2,2,2))),t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},o.scale=a.USE_SIMD?o.SIMD.scale:o.scalar.scale,o.rotate=function(t,e,n,o){var r,i,s,l,u,c,h,d,f,M,m,I,S,x,v,p,g,D,F,E,w,b,y,P,R=o[0],L=o[1],A=o[2],C=Math.sqrt(R*R+L*L+A*A);return Math.abs(C)<a.EPSILON?null:(C=1/C,R*=C,L*=C,A*=C,r=Math.sin(n),i=Math.cos(n),s=1-i,l=e[0],u=e[1],c=e[2],h=e[3],d=e[4],f=e[5],M=e[6],m=e[7],I=e[8],S=e[9],x=e[10],v=e[11],p=R*R*s+i,g=L*R*s+A*r,D=A*R*s-L*r,F=R*L*s-A*r,E=L*L*s+i,w=A*L*s+R*r,b=R*A*s+L*r,y=L*A*s-R*r,P=A*A*s+i,t[0]=l*p+d*g+I*D,t[1]=u*p+f*g+S*D,t[2]=c*p+M*g+x*D,t[3]=h*p+m*g+v*D,t[4]=l*F+d*E+I*w,t[5]=u*F+f*E+S*w,t[6]=c*F+M*E+x*w,t[7]=h*F+m*E+v*w,t[8]=l*b+d*y+I*P,t[9]=u*b+f*y+S*P,t[10]=c*b+M*y+x*P,t[11]=h*b+m*y+v*P,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},o.scalar.rotateX=function(t,e,n){var a=Math.sin(n),o=Math.cos(n),r=e[4],i=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=r*o+u*a,t[5]=i*o+c*a,t[6]=s*o+h*a,t[7]=l*o+d*a,t[8]=u*o-r*a,t[9]=c*o-i*a,t[10]=h*o-s*a,t[11]=d*o-l*a,t},o.SIMD.rotateX=function(t,e,n){var a=SIMD.Float32x4.splat(Math.sin(n)),o=SIMD.Float32x4.splat(Math.cos(n));e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var r=SIMD.Float32x4.load(e,4),i=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(r,o),SIMD.Float32x4.mul(i,a))),
SIMD.Float32x4.store(t,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,o),SIMD.Float32x4.mul(r,a))),t},o.rotateX=a.USE_SIMD?o.SIMD.rotateX:o.scalar.rotateX,o.scalar.rotateY=function(t,e,n){var a=Math.sin(n),o=Math.cos(n),r=e[0],i=e[1],s=e[2],l=e[3],u=e[8],c=e[9],h=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*o-u*a,t[1]=i*o-c*a,t[2]=s*o-h*a,t[3]=l*o-d*a,t[8]=r*a+u*o,t[9]=i*a+c*o,t[10]=s*a+h*o,t[11]=l*a+d*o,t},o.SIMD.rotateY=function(t,e,n){var a=SIMD.Float32x4.splat(Math.sin(n)),o=SIMD.Float32x4.splat(Math.cos(n));e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var r=SIMD.Float32x4.load(e,0),i=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,o),SIMD.Float32x4.mul(i,a))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(r,a),SIMD.Float32x4.mul(i,o))),t},o.rotateY=a.USE_SIMD?o.SIMD.rotateY:o.scalar.rotateY,o.scalar.rotateZ=function(t,e,n){var a=Math.sin(n),o=Math.cos(n),r=e[0],i=e[1],s=e[2],l=e[3],u=e[4],c=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*o+u*a,t[1]=i*o+c*a,t[2]=s*o+h*a,t[3]=l*o+d*a,t[4]=u*o-r*a,t[5]=c*o-i*a,t[6]=h*o-s*a,t[7]=d*o-l*a,t},o.SIMD.rotateZ=function(t,e,n){var a=SIMD.Float32x4.splat(Math.sin(n)),o=SIMD.Float32x4.splat(Math.cos(n));e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var r=SIMD.Float32x4.load(e,0),i=SIMD.Float32x4.load(e,4);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(r,o),SIMD.Float32x4.mul(i,a))),SIMD.Float32x4.store(t,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,o),SIMD.Float32x4.mul(r,a))),t},o.rotateZ=a.USE_SIMD?o.SIMD.rotateZ:o.scalar.rotateZ,o.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},o.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.fromRotation=function(t,e,n){var o,r,i,s=n[0],l=n[1],u=n[2],c=Math.sqrt(s*s+l*l+u*u);return Math.abs(c)<a.EPSILON?null:(c=1/c,s*=c,l*=c,u*=c,o=Math.sin(e),r=Math.cos(e),i=1-r,t[0]=s*s*i+r,t[1]=l*s*i+u*o,t[2]=u*s*i-l*o,t[3]=0,t[4]=s*l*i-u*o,t[5]=l*l*i+r,t[6]=u*l*i+s*o,t[7]=0,t[8]=s*u*i+l*o,t[9]=l*u*i-s*o,t[10]=u*u*i+r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},o.fromXRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.fromYRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.fromZRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.fromRotationTranslation=function(t,e,n){var a=e[0],o=e[1],r=e[2],i=e[3],s=a+a,l=o+o,u=r+r,c=a*s,h=a*l,d=a*u,f=o*l,M=o*u,m=r*u,I=i*s,S=i*l,x=i*u;return t[0]=1-(f+m),t[1]=h+x,t[2]=d-S,t[3]=0,t[4]=h-x,t[5]=1-(c+m),t[6]=M+I,t[7]=0,t[8]=d+S,t[9]=M-I,t[10]=1-(c+f),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},o.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},o.getRotation=function(t,e){var n=e[0]+e[5]+e[10],a=0;return n>0?(a=2*Math.sqrt(n+1),t[3]=.25*a,t[0]=(e[6]-e[9])/a,t[1]=(e[8]-e[2])/a,t[2]=(e[1]-e[4])/a):e[0]>e[5]&e[0]>e[10]?(a=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/a,t[0]=.25*a,t[1]=(e[1]+e[4])/a,t[2]=(e[8]+e[2])/a):e[5]>e[10]?(a=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/a,t[0]=(e[1]+e[4])/a,t[1]=.25*a,t[2]=(e[6]+e[9])/a):(a=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/a,t[0]=(e[8]+e[2])/a,t[1]=(e[6]+e[9])/a,t[2]=.25*a),t},o.fromRotationTranslationScale=function(t,e,n,a){var o=e[0],r=e[1],i=e[2],s=e[3],l=o+o,u=r+r,c=i+i,h=o*l,d=o*u,f=o*c,M=r*u,m=r*c,I=i*c,S=s*l,x=s*u,v=s*c,p=a[0],g=a[1],D=a[2];return t[0]=(1-(M+I))*p,t[1]=(d+v)*p,t[2]=(f-x)*p,t[3]=0,t[4]=(d-v)*g,t[5]=(1-(h+I))*g,t[6]=(m+S)*g,t[7]=0,t[8]=(f+x)*D,t[9]=(m-S)*D,t[10]=(1-(h+M))*D,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},o.fromRotationTranslationScaleOrigin=function(t,e,n,a,o){var r=e[0],i=e[1],s=e[2],l=e[3],u=r+r,c=i+i,h=s+s,d=r*u,f=r*c,M=r*h,m=i*c,I=i*h,S=s*h,x=l*u,v=l*c,p=l*h,g=a[0],D=a[1],F=a[2],E=o[0],w=o[1],b=o[2];return t[0]=(1-(m+S))*g,t[1]=(f+p)*g,t[2]=(M-v)*g,t[3]=0,t[4]=(f-p)*D,t[5]=(1-(d+S))*D,t[6]=(I+x)*D,t[7]=0,t[8]=(M+v)*F,t[9]=(I-x)*F,t[10]=(1-(d+m))*F,t[11]=0,t[12]=n[0]+E-(t[0]*E+t[4]*w+t[8]*b),t[13]=n[1]+w-(t[1]*E+t[5]*w+t[9]*b),t[14]=n[2]+b-(t[2]*E+t[6]*w+t[10]*b),t[15]=1,t},o.fromQuat=function(t,e){var n=e[0],a=e[1],o=e[2],r=e[3],i=n+n,s=a+a,l=o+o,u=n*i,c=a*i,h=a*s,d=o*i,f=o*s,M=o*l,m=r*i,I=r*s,S=r*l;return t[0]=1-h-M,t[1]=c+S,t[2]=d-I,t[3]=0,t[4]=c-S,t[5]=1-u-M,t[6]=f+m,t[7]=0,t[8]=d+I,t[9]=f-m,t[10]=1-u-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.frustum=function(t,e,n,a,o,r,i){var s=1/(n-e),l=1/(o-a),u=1/(r-i);return t[0]=2*r*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*r*l,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(o+a)*l,t[10]=(i+r)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r*2*u,t[15]=0,t},o.perspective=function(t,e,n,a,o){var r=1/Math.tan(e/2),i=1/(a-o);return t[0]=r/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(o+a)*i,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*o*a*i,t[15]=0,t},o.perspectiveFromFieldOfView=function(t,e,n,a){var o=Math.tan(e.upDegrees*Math.PI/180),r=Math.tan(e.downDegrees*Math.PI/180),i=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),l=2/(i+s),u=2/(o+r);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-((i-s)*l*.5),t[9]=(o-r)*u*.5,t[10]=a/(n-a),t[11]=-1,t[12]=0,t[13]=0,t[14]=a*n/(n-a),t[15]=0,t},o.ortho=function(t,e,n,a,o,r,i){var s=1/(e-n),l=1/(a-o),u=1/(r-i);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+n)*s,t[13]=(o+a)*l,t[14]=(i+r)*u,t[15]=1,t},o.lookAt=function(t,e,n,r){var i,s,l,u,c,h,d,f,M,m,I=e[0],S=e[1],x=e[2],v=r[0],p=r[1],g=r[2],D=n[0],F=n[1],E=n[2];return Math.abs(I-D)<a.EPSILON&&Math.abs(S-F)<a.EPSILON&&Math.abs(x-E)<a.EPSILON?o.identity(t):(d=I-D,f=S-F,M=x-E,m=1/Math.sqrt(d*d+f*f+M*M),d*=m,f*=m,M*=m,i=p*M-g*f,s=g*d-v*M,l=v*f-p*d,m=Math.sqrt(i*i+s*s+l*l),m?(m=1/m,i*=m,s*=m,l*=m):(i=0,s=0,l=0),u=f*l-M*s,c=M*i-d*l,h=d*s-f*i,m=Math.sqrt(u*u+c*c+h*h),m?(m=1/m,u*=m,c*=m,h*=m):(u=0,c=0,h=0),t[0]=i,t[1]=u,t[2]=d,t[3]=0,t[4]=s,t[5]=c,t[6]=f,t[7]=0,t[8]=l,t[9]=h,t[10]=M,t[11]=0,t[12]=-(i*I+s*S+l*x),t[13]=-(u*I+c*S+h*x),t[14]=-(d*I+f*S+M*x),t[15]=1,t)},o.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},o.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},o.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},o.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t},o.sub=o.subtract,o.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},o.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t[6]=e[6]+n[6]*a,t[7]=e[7]+n[7]*a,t[8]=e[8]+n[8]*a,t[9]=e[9]+n[9]*a,t[10]=e[10]+n[10]*a,t[11]=e[11]+n[11]*a,t[12]=e[12]+n[12]*a,t[13]=e[13]+n[13]*a,t[14]=e[14]+n[14]*a,t[15]=e[15]+n[15]*a,t},o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},o.equals=function(t,e){var n=t[0],o=t[1],r=t[2],i=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=t[9],f=t[10],M=t[11],m=t[12],I=t[13],S=t[14],x=t[15],v=e[0],p=e[1],g=e[2],D=e[3],F=e[4],E=e[5],w=e[6],b=e[7],y=e[8],P=e[9],R=e[10],L=e[11],A=e[12],C=e[13],T=e[14],z=e[15];return Math.abs(n-v)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(o-p)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(r-g)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(i-D)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(D))&&Math.abs(s-F)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(F))&&Math.abs(l-E)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(u-w)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(w))&&Math.abs(c-b)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(h-y)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(d-P)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(f-R)<=a.EPSILON*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(M-L)<=a.EPSILON*Math.max(1,Math.abs(M),Math.abs(L))&&Math.abs(m-A)<=a.EPSILON*Math.max(1,Math.abs(m),Math.abs(A))&&Math.abs(I-C)<=a.EPSILON*Math.max(1,Math.abs(I),Math.abs(C))&&Math.abs(S-T)<=a.EPSILON*Math.max(1,Math.abs(S),Math.abs(T))&&Math.abs(x-z)<=a.EPSILON*Math.max(1,Math.abs(x),Math.abs(z))},t.exports=o},function(t,e,n){var a=n(1),o=n(4),r=n(7),i=n(8),s={};s.create=function(){var t=new a.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},s.rotationTo=function(){var t=r.create(),e=r.fromValues(1,0,0),n=r.fromValues(0,1,0);return function(a,o,i){var l=r.dot(o,i);return-.999999>l?(r.cross(t,e,o),r.length(t)<1e-6&&r.cross(t,n,o),r.normalize(t,t),s.setAxisAngle(a,t,Math.PI),a):l>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(r.cross(t,o,i),a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=1+l,s.normalize(a,a))}}(),s.setAxes=function(){var t=o.create();return function(e,n,a,o){return t[0]=a[0],t[3]=a[1],t[6]=a[2],t[1]=o[0],t[4]=o[1],t[7]=o[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],s.normalize(e,s.fromMat3(e,t))}}(),s.clone=i.clone,s.fromValues=i.fromValues,s.copy=i.copy,s.set=i.set,s.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},s.setAxisAngle=function(t,e,n){n=.5*n;var a=Math.sin(n);return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=Math.cos(n),t},s.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),a=Math.sin(n/2);return 0!=a?(t[0]=e[0]/a,t[1]=e[1]/a,t[2]=e[2]/a):(t[0]=1,t[1]=0,t[2]=0),n},s.add=i.add,s.multiply=function(t,e,n){var a=e[0],o=e[1],r=e[2],i=e[3],s=n[0],l=n[1],u=n[2],c=n[3];return t[0]=a*c+i*s+o*u-r*l,t[1]=o*c+i*l+r*s-a*u,t[2]=r*c+i*u+a*l-o*s,t[3]=i*c-a*s-o*l-r*u,t},s.mul=s.multiply,s.scale=i.scale,s.rotateX=function(t,e,n){n*=.5;var a=e[0],o=e[1],r=e[2],i=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=a*l+i*s,t[1]=o*l+r*s,t[2]=r*l-o*s,t[3]=i*l-a*s,t},s.rotateY=function(t,e,n){n*=.5;var a=e[0],o=e[1],r=e[2],i=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=a*l-r*s,t[1]=o*l+i*s,t[2]=r*l+a*s,t[3]=i*l-o*s,t},s.rotateZ=function(t,e,n){n*=.5;var a=e[0],o=e[1],r=e[2],i=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=a*l+o*s,t[1]=o*l-a*s,t[2]=r*l+i*s,t[3]=i*l-r*s,t},s.calculateW=function(t,e){var n=e[0],a=e[1],o=e[2];return t[0]=n,t[1]=a,t[2]=o,t[3]=Math.sqrt(Math.abs(1-n*n-a*a-o*o)),t},s.dot=i.dot,s.lerp=i.lerp,s.slerp=function(t,e,n,a){var o,r,i,s,l,u=e[0],c=e[1],h=e[2],d=e[3],f=n[0],M=n[1],m=n[2],I=n[3];return r=u*f+c*M+h*m+d*I,0>r&&(r=-r,f=-f,M=-M,m=-m,I=-I),1-r>1e-6?(o=Math.acos(r),i=Math.sin(o),s=Math.sin((1-a)*o)/i,l=Math.sin(a*o)/i):(s=1-a,l=a),t[0]=s*u+l*f,t[1]=s*c+l*M,t[2]=s*h+l*m,t[3]=s*d+l*I,t},s.sqlerp=function(){var t=s.create(),e=s.create();return function(n,a,o,r,i,l){return s.slerp(t,a,i,l),s.slerp(e,o,r,l),s.slerp(n,t,e,2*l*(1-l)),n}}(),s.invert=function(t,e){var n=e[0],a=e[1],o=e[2],r=e[3],i=n*n+a*a+o*o+r*r,s=i?1/i:0;return t[0]=-n*s,t[1]=-a*s,t[2]=-o*s,t[3]=r*s,t},s.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},s.length=i.length,s.len=s.length,s.squaredLength=i.squaredLength,s.sqrLen=s.squaredLength,s.normalize=i.normalize,s.fromMat3=function(t,e){var n,a=e[0]+e[4]+e[8];if(a>0)n=Math.sqrt(a+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var o=0;e[4]>e[0]&&(o=1),e[8]>e[3*o+o]&&(o=2);var r=(o+1)%3,i=(o+2)%3;n=Math.sqrt(e[3*o+o]-e[3*r+r]-e[3*i+i]+1),t[o]=.5*n,n=.5/n,t[3]=(e[3*r+i]-e[3*i+r])*n,t[r]=(e[3*r+o]+e[3*o+r])*n,t[i]=(e[3*i+o]+e[3*o+i])*n}return t},s.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},s.exactEquals=i.exactEquals,s.equals=i.equals,t.exports=s},function(t,e,n){var a=n(1),o={};o.create=function(){var t=new a.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t},o.clone=function(t){var e=new a.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},o.fromValues=function(t,e,n){var o=new a.ARRAY_TYPE(3);return o[0]=t,o[1]=e,o[2]=n,o},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},o.set=function(t,e,n,a){return t[0]=e,t[1]=n,t[2]=a,t},o.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},o.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t},o.sub=o.subtract,o.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t},o.mul=o.multiply,o.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},o.div=o.divide,o.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},o.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},o.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},o.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},o.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},o.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},o.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t},o.distance=function(t,e){var n=e[0]-t[0],a=e[1]-t[1],o=e[2]-t[2];return Math.sqrt(n*n+a*a+o*o)},o.dist=o.distance,o.squaredDistance=function(t,e){var n=e[0]-t[0],a=e[1]-t[1],o=e[2]-t[2];return n*n+a*a+o*o},o.sqrDist=o.squaredDistance,o.length=function(t){var e=t[0],n=t[1],a=t[2];return Math.sqrt(e*e+n*n+a*a)},o.len=o.length,o.squaredLength=function(t){var e=t[0],n=t[1],a=t[2];return e*e+n*n+a*a},o.sqrLen=o.squaredLength,o.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},o.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},o.normalize=function(t,e){var n=e[0],a=e[1],o=e[2],r=n*n+a*a+o*o;return r>0&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r),t},o.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},o.cross=function(t,e,n){var a=e[0],o=e[1],r=e[2],i=n[0],s=n[1],l=n[2];return t[0]=o*l-r*s,t[1]=r*i-a*l,t[2]=a*s-o*i,t},o.lerp=function(t,e,n,a){var o=e[0],r=e[1],i=e[2];return t[0]=o+a*(n[0]-o),t[1]=r+a*(n[1]-r),t[2]=i+a*(n[2]-i),t},o.hermite=function(t,e,n,a,o,r){var i=r*r,s=i*(2*r-3)+1,l=i*(r-2)+r,u=i*(r-1),c=i*(3-2*r);return t[0]=e[0]*s+n[0]*l+a[0]*u+o[0]*c,t[1]=e[1]*s+n[1]*l+a[1]*u+o[1]*c,t[2]=e[2]*s+n[2]*l+a[2]*u+o[2]*c,t},o.bezier=function(t,e,n,a,o,r){var i=1-r,s=i*i,l=r*r,u=s*i,c=3*r*s,h=3*l*i,d=l*r;return t[0]=e[0]*u+n[0]*c+a[0]*h+o[0]*d,t[1]=e[1]*u+n[1]*c+a[1]*h+o[1]*d,t[2]=e[2]*u+n[2]*c+a[2]*h+o[2]*d,t},o.random=function(t,e){e=e||1;var n=2*a.RANDOM()*Math.PI,o=2*a.RANDOM()-1,r=Math.sqrt(1-o*o)*e;return t[0]=Math.cos(n)*r,t[1]=Math.sin(n)*r,t[2]=o*e,t},o.transformMat4=function(t,e,n){var a=e[0],o=e[1],r=e[2],i=n[3]*a+n[7]*o+n[11]*r+n[15];return i=i||1,t[0]=(n[0]*a+n[4]*o+n[8]*r+n[12])/i,t[1]=(n[1]*a+n[5]*o+n[9]*r+n[13])/i,t[2]=(n[2]*a+n[6]*o+n[10]*r+n[14])/i,t},o.transformMat3=function(t,e,n){var a=e[0],o=e[1],r=e[2];return t[0]=a*n[0]+o*n[3]+r*n[6],t[1]=a*n[1]+o*n[4]+r*n[7],t[2]=a*n[2]+o*n[5]+r*n[8],t},o.transformQuat=function(t,e,n){var a=e[0],o=e[1],r=e[2],i=n[0],s=n[1],l=n[2],u=n[3],c=u*a+s*r-l*o,h=u*o+l*a-i*r,d=u*r+i*o-s*a,f=-i*a-s*o-l*r;return t[0]=c*u+f*-i+h*-l-d*-s,t[1]=h*u+f*-s+d*-i-c*-l,t[2]=d*u+f*-l+c*-s-h*-i,t},o.rotateX=function(t,e,n,a){var o=[],r=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],r[0]=o[0],r[1]=o[1]*Math.cos(a)-o[2]*Math.sin(a),r[2]=o[1]*Math.sin(a)+o[2]*Math.cos(a),t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t},o.rotateY=function(t,e,n,a){var o=[],r=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],r[0]=o[2]*Math.sin(a)+o[0]*Math.cos(a),r[1]=o[1],r[2]=o[2]*Math.cos(a)-o[0]*Math.sin(a),t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t},o.rotateZ=function(t,e,n,a){var o=[],r=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],r[0]=o[0]*Math.cos(a)-o[1]*Math.sin(a),r[1]=o[0]*Math.sin(a)+o[1]*Math.cos(a),r[2]=o[2],t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t},o.forEach=function(){var t=o.create();return function(e,n,a,o,r,i){var s,l;for(n||(n=3),a||(a=0),l=o?Math.min(o*n+a,e.length):e.length,s=a;l>s;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],r(t,t,i),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}(),o.angle=function(t,e){var n=o.fromValues(t[0],t[1],t[2]),a=o.fromValues(e[0],e[1],e[2]);o.normalize(n,n),o.normalize(a,a);var r=o.dot(n,a);return r>1?0:Math.acos(r)},o.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},o.equals=function(t,e){var n=t[0],o=t[1],r=t[2],i=e[0],s=e[1],l=e[2];return Math.abs(n-i)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(o-s)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(s))&&Math.abs(r-l)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))},t.exports=o},function(t,e,n){var a=n(1),o={};o.create=function(){var t=new a.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},o.clone=function(t){var e=new a.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},o.fromValues=function(t,e,n,o){var r=new a.ARRAY_TYPE(4);return r[0]=t,r[1]=e,r[2]=n,r[3]=o,r},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},o.set=function(t,e,n,a,o){return t[0]=e,t[1]=n,t[2]=a,t[3]=o,t},o.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},o.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t},o.sub=o.subtract,o.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t},o.mul=o.multiply,o.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t},o.div=o.divide,o.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},o.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},o.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},o.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},o.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},o.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},o.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t},o.distance=function(t,e){var n=e[0]-t[0],a=e[1]-t[1],o=e[2]-t[2],r=e[3]-t[3];return Math.sqrt(n*n+a*a+o*o+r*r)},o.dist=o.distance,o.squaredDistance=function(t,e){var n=e[0]-t[0],a=e[1]-t[1],o=e[2]-t[2],r=e[3]-t[3];return n*n+a*a+o*o+r*r},o.sqrDist=o.squaredDistance,o.length=function(t){var e=t[0],n=t[1],a=t[2],o=t[3];return Math.sqrt(e*e+n*n+a*a+o*o)},o.len=o.length,o.squaredLength=function(t){var e=t[0],n=t[1],a=t[2],o=t[3];return e*e+n*n+a*a+o*o},o.sqrLen=o.squaredLength,o.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},o.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},o.normalize=function(t,e){var n=e[0],a=e[1],o=e[2],r=e[3],i=n*n+a*a+o*o+r*r;return i>0&&(i=1/Math.sqrt(i),t[0]=n*i,t[1]=a*i,t[2]=o*i,t[3]=r*i),t},o.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},o.lerp=function(t,e,n,a){var o=e[0],r=e[1],i=e[2],s=e[3];return t[0]=o+a*(n[0]-o),t[1]=r+a*(n[1]-r),t[2]=i+a*(n[2]-i),t[3]=s+a*(n[3]-s),t},o.random=function(t,e){return e=e||1,t[0]=a.RANDOM(),t[1]=a.RANDOM(),t[2]=a.RANDOM(),t[3]=a.RANDOM(),o.normalize(t,t),o.scale(t,t,e),t},o.transformMat4=function(t,e,n){var a=e[0],o=e[1],r=e[2],i=e[3];return t[0]=n[0]*a+n[4]*o+n[8]*r+n[12]*i,t[1]=n[1]*a+n[5]*o+n[9]*r+n[13]*i,t[2]=n[2]*a+n[6]*o+n[10]*r+n[14]*i,t[3]=n[3]*a+n[7]*o+n[11]*r+n[15]*i,t},o.transformQuat=function(t,e,n){var a=e[0],o=e[1],r=e[2],i=n[0],s=n[1],l=n[2],u=n[3],c=u*a+s*r-l*o,h=u*o+l*a-i*r,d=u*r+i*o-s*a,f=-i*a-s*o-l*r;return t[0]=c*u+f*-i+h*-l-d*-s,t[1]=h*u+f*-s+d*-i-c*-l,t[2]=d*u+f*-l+c*-s-h*-i,t[3]=e[3],t},o.forEach=function(){var t=o.create();return function(e,n,a,o,r,i){var s,l;for(n||(n=4),a||(a=0),l=o?Math.min(o*n+a,e.length):e.length,s=a;l>s;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],r(t,t,i),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),o.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},o.equals=function(t,e){var n=t[0],o=t[1],r=t[2],i=t[3],s=e[0],l=e[1],u=e[2],c=e[3];return Math.abs(n-s)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(o-l)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(r-u)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-c)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))},t.exports=o},function(t,e,n){var a=n(1),o={};o.create=function(){var t=new a.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},o.clone=function(t){var e=new a.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},o.fromValues=function(t,e){var n=new a.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},o.set=function(t,e,n){return t[0]=e,t[1]=n,t},o.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},o.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t},o.sub=o.subtract,o.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t},o.mul=o.multiply,o.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t},o.div=o.divide,o.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},o.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},o.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},o.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},o.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},o.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},o.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t},o.distance=function(t,e){var n=e[0]-t[0],a=e[1]-t[1];return Math.sqrt(n*n+a*a)},o.dist=o.distance,o.squaredDistance=function(t,e){var n=e[0]-t[0],a=e[1]-t[1];return n*n+a*a},o.sqrDist=o.squaredDistance,o.length=function(t){var e=t[0],n=t[1];return Math.sqrt(e*e+n*n)},o.len=o.length,o.squaredLength=function(t){var e=t[0],n=t[1];return e*e+n*n},o.sqrLen=o.squaredLength,o.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},o.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},o.normalize=function(t,e){var n=e[0],a=e[1],o=n*n+a*a;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o),t},o.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},o.cross=function(t,e,n){var a=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=a,t},o.lerp=function(t,e,n,a){var o=e[0],r=e[1];return t[0]=o+a*(n[0]-o),t[1]=r+a*(n[1]-r),t},o.random=function(t,e){e=e||1;var n=2*a.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},o.transformMat2=function(t,e,n){var a=e[0],o=e[1];return t[0]=n[0]*a+n[2]*o,t[1]=n[1]*a+n[3]*o,t},o.transformMat2d=function(t,e,n){var a=e[0],o=e[1];return t[0]=n[0]*a+n[2]*o+n[4],t[1]=n[1]*a+n[3]*o+n[5],t},o.transformMat3=function(t,e,n){var a=e[0],o=e[1];return t[0]=n[0]*a+n[3]*o+n[6],t[1]=n[1]*a+n[4]*o+n[7],t},o.transformMat4=function(t,e,n){var a=e[0],o=e[1];return t[0]=n[0]*a+n[4]*o+n[12],t[1]=n[1]*a+n[5]*o+n[13],t},o.forEach=function(){var t=o.create();return function(e,n,a,o,r,i){var s,l;for(n||(n=2),a||(a=0),l=o?Math.min(o*n+a,e.length):e.length,s=a;l>s;s+=n)t[0]=e[s],t[1]=e[s+1],r(t,t,i),e[s]=t[0],e[s+1]=t[1];return e}}(),o.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},o.equals=function(t,e){var n=t[0],o=t[1],r=e[0],i=e[1];return Math.abs(n-r)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(o-i)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(i))},t.exports=o}])}),CanvasSurface.prototype.getElements=function(){return this.elements},CanvasSurface.prototype.pushLabel=function(){var t=this.factory.createLabel();return this.elements.add(t),this.elements.selectLast(),this.eventHandler.triggerSelect(t),this.render(),t},CanvasSurface.prototype.pushImage=function(t){var e=this.factory.createImage(t);return this.elements.add(e),this.elements.selectLast(),this.eventHandler.triggerSelect(e),this.render(),e},CanvasSurface.prototype.clear=function(){this.context.fillStyle=this.clearColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)},CanvasSurface.prototype.setClearColor=function(t){this.clearColor=t},CanvasSurface.prototype.renderElements=function(){for(var t=this.elements.getSelectedIndex(),e=0;e<this.elements.length;e++)if(this.elements.get(e).render(),e==t&&!this._isExportingRender){var n="#ffffff";"#ffffff"==this.clearColor.toLowerCase()&&(n="#2e6da4"),new CanvasUISelectedView(this.context,{color:n,size:15}).render(this.elements.get(e))}},CanvasSurface.prototype.render=function(){this.clear(),this.renderElements()},CanvasSurface.prototype.toImage=function(){this._isExportingRender=!0,this.render();var t=new Image;return t.src=this.canvas.toDataURL(),this._isExportingRender=!1,this.render(),t},CanvasSurface.prototype.selectedToBackground=function(){this.elements.toStart(this.elements.getSelectedIndex())},CanvasSurface.prototype.selectedToForeground=function(){this.elements.toEnd(this.elements.getSelectedIndex())},CanvasSurface.prototype.removeSelected=function(){var t=this.elements.remove(this.elements.getSelectedIndex());return this.eventHandler.triggerDeselect(),t},CanvasSurface.prototype.addSelectEventHandler=function(t){this.eventHandler.addSelectEventHandler(t)},CanvasSurface.prototype.addDeselectEventHandler=function(t){this.eventHandler.addDeselectEventHandler(t)},CanvasSurface.prototype.getBounds=function(){return{top:0,right:this.canvas.width,bottom:this.canvas.height,left:0}},CanvasSurfaceEventHandler.prototype.bindHtmlCanvasEvents=function(t){this.surface.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.surface.canvas.addEventListener("touchstart",this.handleMouseDown.bind(this)),document.addEventListener("mouseup",this.handleMouseUp.bind(this)),document.addEventListener("touchend",this.handleMouseUp.bind(this)),this.surface.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.surface.canvas.addEventListener("touchmove",this.handleMouseMove.bind(this))},CanvasSurfaceEventHandler.prototype.triggerSelect=function(t){for(var e in this.handlers.onSelect){var n=this.handlers.onSelect[e];n instanceof Function&&n(t)}},CanvasSurfaceEventHandler.prototype.triggerDeselect=function(){for(var t in this.handlers.onDeselect){var e=this.handlers.onDeselect[t];e instanceof Function&&e()}},CanvasSurfaceEventHandler.prototype.addSelectEventHandler=function(t){this.handlers.onSelect.push(t)},CanvasSurfaceEventHandler.prototype.addDeselectEventHandler=function(t){this.handlers.onDeselect.push(t)},CanvasSurfaceEventHandler.prototype.handleMouseDown=function(t){this.isMouseDown=!0,"undefined"!=typeof TouchEvent&&t instanceof TouchEvent&&(t=t.touches[0]);var e=this.toLocalCoordinates(t.clientX,t.clientY),n=this.surface.getElements().getSelectedIndex(),a=this.surface.elements.fetchIndexByOffset(e.x,e.y),o=this.surface.elements.get(a),r=null!==a,i=r&&n==a;return r?(i||this.triggerSelect(o),this.lastClickOffset=o.getClickOffset(e.x,e.y),this.isResizingClick=i&&this.isResizePossible(o,e.x,e.y),this.isResizingClick?(this.lastResizeCoordinates=e,this.setResizableState(!0)):(this.isMovingClick=!0,this.surface.elements.select(a),this.setMovableState(!0)),void this.surface.render()):(null!=n&&this.triggerDeselect(),this.surface.elements.deselect(),void this.surface.render())},CanvasSurfaceEventHandler.prototype.handleMouseUp=function(t){this.isMouseDown=!1,this.isResizingClick=!1,this.isMovingClick=!1},CanvasSurfaceEventHandler.prototype.toLocalCoordinates=function(t,e){var n=this.surface.canvas.getBoundingClientRect(),a=n.top,o=n.left,r=e-a,i=t-o;return{x:i,y:r}},CanvasSurfaceEventHandler.prototype.handleMouseMove=function(t){var e=t;"undefined"!=typeof TouchEvent&&t instanceof TouchEvent&&(t=t.touches[0]);var n=this.surface.elements.getSelectedIndex(),a=this.toLocalCoordinates(t.clientX,t.clientY),o=this.surface.elements.fetchIndexByOffset(a.x,a.y);if(!this.isMouseDown)return void this.handleMouseMoveWithoutMouseDown(o,n,a);(this.isMovingClick||this.isResizingClick)&&e.preventDefault();var r=this.surface.elements.getSelectedElement();if(this.isResizingClick){var i={width:a.x-this.lastResizeCoordinates.x,height:a.y-this.lastResizeCoordinates.y};this.lastResizeCoordinates=a;var s=r.getSize();s.resizeBy(i.width,i.height)}else this.isMovingClick&&r.moveTo(new Position(a.x-this.lastClickOffset.top,a.y-this.lastClickOffset.left));this.surface.render()},CanvasSurfaceEventHandler.prototype.setMovableState=function(t){t?(this.surface.canvas.classList.add("movable"),this.surface.canvas.classList.remove("resizable")):this.surface.canvas.classList.remove("movable")},CanvasSurfaceEventHandler.prototype.setResizableState=function(t){t?(this.surface.canvas.classList.remove("movable"),this.surface.canvas.classList.add("resizable")):this.surface.canvas.classList.remove("resizable")},CanvasSurfaceEventHandler.prototype.handleMouseMoveWithoutMouseDown=function(t,e,n){if(t==e){var a=this.isResizePossible(this.surface.elements.getSelectedElement(),n.x,n.y);a?this.setResizableState(!0):this.setMovableState(!0)}else this.setMovableState(!1),this.setResizableState(!1)},CanvasSurfaceEventHandler.prototype.isResizePossible=function(t,e,n){var a=20,o={position:new Position(t.getPosition().getX()+t.getSize().getWidth()-a,t.getPosition().getY()+t.getSize().getHeight()-a),size:new Size(a,a)},r=new UIElement(o.position,o.size);return r.isOffsetIn(e,n)},CanvasUIElementView.prototype=Object.create(UIElementView.prototype),CanvasUIElementView.prototype.render=function(t){},CanvasUIFactory.prototype.createLabel=function(){var t=new UILabelElement(new Position(0,50));return t.setView(new CanvasUILabelView(this.context)),t},CanvasUIFactory.prototype.createImage=function(t){var e=new UIImageElement(null,null,t);return e.setView(new CanvasUIImageView(this.context)),e},CanvasUIImageView.prototype=Object.create(CanvasUIElementView.prototype),CanvasUIImageView.prototype.render=function(t){var e=t.getPosition(),n=t.getSize();this.context.drawImage(t.getImage(),e.getX(),e.getY(),n.getWidth(),n.getHeight())},CanvasUILabelView.prototype=Object.create(CanvasUIElementView.prototype),
CanvasUILabelView.prototype.render=function(t){var e=t.getSize().getHeight();this.context.font=e+"px "+t.getFont(),this.context.fillStyle=t.getColor(),this.context.textBaseline="hanging",this.context.fillText(t.getText(),t.getPosition().getX(),t.getPosition().getY(),t.getSize().getWidth())},CanvasUISelectedView.prototype=Object.create(CanvasUIElementView.prototype),CanvasUISelectedView.prototype.render=function(t){this.context.font=this.resizeIconWidth+"px Arial",this.context.fillStyle=this.fillStyle,this.context.textBaseline="bottom",this.context.fillText(CanvasUISelectedView.ResizeSymbol,t.getPosition().getX()+t.getSize().getWidth()-this.resizeIconWidth,t.getPosition().getY()+t.getSize().getHeight(),this.resizeIconWidth),this.context.strokeStyle=this.fillStyle,this.context.strokeRect(t.getPosition().getX(),t.getPosition().getY(),t.getSize().getWidth(),t.getSize().getHeight())},CanvasUISelectedView.ResizeSymbol="",Position.prototype.getX=function(){return this.x},Position.prototype.getY=function(){return this.y},Position.prototype.move=function(t,e){var n=this.x+t,a=this.y+e;return new Position(n,a)},ResourceLoader.prototype.loadImage=function(t,e){var n=new Image;e instanceof Function&&(n.onload=e),n.src=t},ResourceLoader.prototype.loadText=function(t,e){var n=new XMLHttpRequest;n.onload=function(){e instanceof Function&&e(this.responseText)},n.open("GET",t,!0),n.send()},ResourceLoader.prototype.loadJsonObject=function(t,e){this.loadText(t,function(t){e instanceof Function&&e(JSON.parse(t))})},ResourcePreparer.prototype.startLoading=function(){var t=0,e=this.resourcesToLoad.length,n=this.onLoad,a=this.loader,o=function(a,o){Storage.remember(a,o),t++,t==e&&n()},r={image:function(t,e){a.loadImage(t,function(){o(e,this)})},json:function(t,e){a.loadJsonObject(t,function(t){o(e,t)})},text:function(t,e){a.loadText(t,function(t){o(e,t)})}};this.resourcesToLoad.forEach(function(t){var e=t.type,n=t.key,a=t.src;if(!r.hasOwnProperty(e))throw new ReferenceError("Trying to load unknown resource type!");r[e](a,n)})},Size.prototype.getWidth=function(){return this.width},Size.prototype.getHeight=function(){return this.height},Size.prototype.resizeBy=function(t,e){this.width+=t,this.height+=e,this.width<Size.minWidth&&(this.width=Size.minWidth),this.height<Size.minHeight&&(this.height=Size.minHeight)},Size.prototype.multiply=function(t){return new Size(this.width*t,this.height*t)},Size.minWidth=40,Size.minHeight=40,Size.defaultWidth=150,Size.defaultHeight=70,Storage._content={},Storage.remember=function(t,e){Storage._content[t]=e},Storage.get=function(t){var e=Storage._content[t];if("undefined"==typeof e)throw new ReferenceError("We have nothing to return using key: "+t);return e},UICollection.prototype.add=function(t){if(!(t instanceof UIElement))throw new TypeError("Element in UICollection must have UIElement type");this.elements.push(t)},UICollection.prototype.getAll=function(){return this.elements},UICollection.prototype.remove=function(t){if(!this.has(t))throw new RangeError("Collection: index out of bounds!");return t==this.selectedIndex&&this.deselect(),this.elements.splice(t,1)[0]},UICollection.prototype.swap=function(t,e){if(!this.has(t)||!this.has(e))throw new RangeError("Collection: index out of bounds!");var n=this.elements[t];this.elements[t]=this.elements[e],this.elements[e]=n},UICollection.prototype.has=function(t){return t>=0||t<this.length},UICollection.prototype.get=function(t){if(!this.has(t))throw new RangeError("Collection: index out of bounds!");return this.elements[t]},UICollection.prototype.deselect=function(){this.selectedIndex=-1},UICollection.prototype.select=function(t){if(!this.has(t))throw new RangeError("Collection: index out of bounds!");this.selectedIndex=t},UICollection.prototype.selectLast=function(){this.selectedIndex=this.length?this.length-1:-1},UICollection.prototype.getSelectedElement=function(){return-1!=this.selectedIndex?this.elements[this.selectedIndex]:null},UICollection.prototype.getSelectedIndex=function(){return this.selectedIndex},UICollection.prototype.fetchElementByOffset=function(t,e){var n=null;return this.elements.forEach(function(a){a.isOffsetIn(t,e)&&(n=a)}),n},UICollection.prototype.toEnd=function(t){if(!this.has(t))throw new RangeError("Collection: index out of bounds!");var e=this.selectedIndex==t,n=this.remove(t);this.add(n),e&&(this.selectedIndex=this.length-1)},UICollection.prototype.toStart=function(t){if(!this.has(t))throw new RangeError("Collection: index out of bounds!");var e=this.selectedIndex==t,n=this.remove(t);this.elements=[n].concat(this.elements),e&&(this.selectedIndex=0)},UICollection.prototype.fetchIndexByOffset=function(t,e){var n=null;return this.elements.forEach(function(a,o){a.isOffsetIn(t,e)&&(n=o)}),n},UIElement.prototype.setView=function(t){if(!(t instanceof UIElementView))throw new TypeError("View must have UIElementView type!");this.view=t},UIElement.prototype.getView=function(){return this.view},UIElement.prototype.render=function(){if(!this.view)throw new ReferenceError("View is not set!");this.view.render(this)},UIElement.prototype.moveTo=function(t){if(!t instanceof Position)throw new TypeError("new position must have Position type!");return this.position=t,this},UIElement.prototype.getPosition=function(){return this.position},UIElement.prototype.setSize=function(t){this.size=t},UIElement.prototype.getSize=function(){return this.size},UIElement.prototype.isOffsetIn=function(t,e){var n=this.getPosition(),a=this.getSize();return n.getX()>t||n.getX()+a.getWidth()<t?!1:!(n.getY()>e||n.getY()+a.getHeight()<e)},UIElement.prototype.getClickOffset=function(t,e){var n=this.getPosition();return{top:t-n.getX(),left:e-n.getY()}},UIElementView.prototype.render=function(t){throw TypeError("You should not be using an abstract object for rendering!")},UIImageElement.prototype=Object.create(UIElement.prototype),UIImageElement.prototype.getImage=function(){return this.image},UILabelElement.prototype=Object.create(UIElement.prototype),UILabelElement.prototype.getText=function(){return this.text},UILabelElement.prototype.setText=function(t){this.text=t},UILabelElement.prototype.getFont=function(){return this.font},UILabelElement.prototype.setFont=function(t){this.font=t},UILabelElement.prototype.getColor=function(){return this.color},UILabelElement.prototype.setColor=function(t){this.color=t},UILabelElement.defaultText=" ...",UILabelElement.defaultStyle={font:"Arial",color:"#000000"},Camera.prototype.getNewPosition=function(){return[Math.cos(this.angleFi*Camera.ToRadians)*Math.sin(this.angleTheta*Camera.ToRadians)*this.distance,Math.sin(this.angleTheta*Camera.ToRadians)*Math.sin(this.angleFi*Camera.ToRadians)*this.distance,this.distance*Math.cos(this.angleTheta*Camera.ToRadians)]},Camera.prototype.move=function(t,e){this.angleFi+=t;var n=this.angleTheta+e;n<this.maxAngleTheta&&n>this.minAngleTheta&&(this.angleTheta=n),this.position=this.getNewPosition(),this.updateMatrix()},Camera.prototype.zoomIn=function(){this.distance>4&&(this.distance--,this.position=this.getNewPosition(),this.updateMatrix())},Camera.prototype.zoomOut=function(){this.distance<20&&(this.distance++,this.position=this.getNewPosition(),this.updateMatrix())},Camera.prototype.setAngle=function(t,e){this.angleFi=t,this.angleTheta=e,this.position=this.getNewPosition()},Camera.prototype.setDistance=function(t){this.distance=t,this.position=this.getNewPosition()},Camera.prototype.updateMatrix=function(){mat4.lookAt(this.matrix,this.position,this.lookAt,this.up)},Camera.ToRadians=Math.PI/180,Model.prototype.buildBuffers=function(t,e){this.modelVertexes=e.meshes[0].vertices,this.modelIndexes=Array.prototype.concat.apply([],e.meshes[0].faces),this.modelTexCoords=e.meshes[0].texturecoords[0],this.modelNormals=e.meshes[0].normals,this.modelVertexBufferObject=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.modelVertexBufferObject),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.modelVertexes),t.STATIC_DRAW),this.modelTexCoordsBufferObject=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.modelTexCoordsBufferObject),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.modelTexCoords),t.STATIC_DRAW),this.modelIndexBufferObject=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.modelIndexBufferObject),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.modelIndexes),t.STATIC_DRAW),this.modelNormalBufferObject=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.modelNormalBufferObject),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.modelNormals),t.STATIC_DRAW)},Model.prototype.bindBuffers=function(t){t.bindBuffer(t.ARRAY_BUFFER,this.modelVertexBufferObject),t.bindBuffer(t.ARRAY_BUFFER,this.modelTexCoordsBufferObject),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.modelIndexBufferObject),t.bindBuffer(t.ARRAY_BUFFER,this.modelNormalBufferObject)},ModelView.prototype.initialize=function(t,e){var n=this.gl;n.enable(n.DEPTH_TEST),n.clearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT);var a=new ShaderCompiler(n);this.shaderProgram=a.makeProgram(t,e)},ModelView.prototype.setTexture=function(t){this.texture=t;var e=this.gl;this.modelTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.modelTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.texture),e.bindTexture(e.TEXTURE_2D,null)},ModelView.prototype.setModel=function(t){this.model=t;var e=this.shaderProgram,n=this.gl;t.bindBuffers(n);var a=n.getAttribLocation(e,"vertPosition");n.bindBuffer(n.ARRAY_BUFFER,t.modelVertexBufferObject),n.vertexAttribPointer(a,3,n.FLOAT,n.FALSE,3*Float32Array.BYTES_PER_ELEMENT,0),n.enableVertexAttribArray(a),n.bindBuffer(n.ARRAY_BUFFER,t.modelTexCoordsBufferObject);var o=n.getAttribLocation(e,"vertTexCoord");n.vertexAttribPointer(o,2,n.FLOAT,n.FALSE,2*Float32Array.BYTES_PER_ELEMENT,0),n.enableVertexAttribArray(o),n.bindBuffer(n.ARRAY_BUFFER,t.modelNormalBufferObject);var r=n.getAttribLocation(e,"vertNormal");n.vertexAttribPointer(r,3,n.FLOAT,n.TRUE,3*Float32Array.BYTES_PER_ELEMENT,0),n.enableVertexAttribArray(r)},ModelView.prototype.startRender=function(){var t=this.gl;this.matWorldUniformLocation=t.getUniformLocation(this.shaderProgram,"mWorld"),this.matViewUniformLocation=t.getUniformLocation(this.shaderProgram,"mView"),this.matProjectionUniformLocation=t.getUniformLocation(this.shaderProgram,"mProjection"),this.worldMatrix=new Float32Array(16),this.projectionMatrix=new Float32Array(16),mat4.identity(this.worldMatrix),mat4.perspective(this.projectionMatrix,glMatrix.toRadian(30),this.canvas.width/this.canvas.height,.1,1e3),t.useProgram(this.shaderProgram),this.gl.uniformMatrix4fv(this.matWorldUniformLocation,this.gl.FALSE,this.worldMatrix),t.uniformMatrix4fv(this.matWorldUniformLocation,t.FALSE,this.worldMatrix),t.uniformMatrix4fv(this.matViewUniformLocation,t.FALSE,this.camera.matrix),t.uniformMatrix4fv(this.matProjectionUniformLocation,t.FALSE,this.projectionMatrix),this.bindCanvasHandlers(),this.animationRequest=requestAnimationFrame(this.loop.bind(this))},ModelView.prototype.updateViewport=function(){this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)},ModelView.prototype.loop=function(){this.drawScene(),requestAnimationFrame(this.loop.bind(this))},ModelView.prototype.drawScene=function(){var t=this.gl;t.uniformMatrix4fv(this.matViewUniformLocation,t.FALSE,this.camera.matrix),t.bindTexture(t.TEXTURE_2D,this.modelTexture),t.activeTexture(t.TEXTURE0),t.clearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a),t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT),t.drawElements(t.TRIANGLES,this.model.modelIndexes.length,t.UNSIGNED_SHORT,0)},ModelView.prototype.bindCanvasHandlers=function(){var t=!1,e=null,n=this.camera,a=function(n){"undefined"!=typeof TouchEvent&&n instanceof TouchEvent&&(n=n.touches[0]),t=!0,e=n},o=function(n){t=!1,e=null},r=function(a){if("undefined"!=typeof TouchEvent&&a instanceof TouchEvent&&(a.preventDefault(),a=a.touches[0]),t){var o=e.clientX-a.clientX,r=e.clientY-a.clientY;e=a,n.move(o,r)}};this.canvas.addEventListener("mousedown",a),this.canvas.addEventListener("touchstart",a),this.canvas.addEventListener("mouseup",o),this.canvas.addEventListener("touchend",o),this.canvas.addEventListener("mousemove",r),this.canvas.addEventListener("touchmove",r)},ModelView.prototype.makePreviewImage=function(){cancelAnimationFrame(this.animationRequest);var t=this.clearColor;this.clearColor={r:0,g:0,b:0,a:0};var e={angleFi:this.camera.angleFi,angleTheta:this.camera.angleTheta,distance:this.camera.distance};this.camera.setAngle(-98,77),this.camera.setDistance(20),this.camera.updateMatrix(),this.drawScene(),this.clearColor=t;var n=new Image;return n.src=this.canvas.toDataURL(),this.camera.setAngle(e.angleFi,e.angleTheta),this.camera.setDistance(e.distance),this.camera.updateMatrix(),this.animationRequest=requestAnimationFrame(this.loop.bind(this)),n},ShaderCompiler.prototype.makeProgram=function(t,e){var n=this.webGLContext,a=n.createShader(n.VERTEX_SHADER),o=n.createShader(n.FRAGMENT_SHADER);if(n.shaderSource(a,t),n.shaderSource(o,e),n.compileShader(a),!n.getShaderParameter(a,n.COMPILE_STATUS))throw new Error("Error compiling vertex shader!",n.getShaderInfoLog(a));if(n.compileShader(o),!n.getShaderParameter(o,n.COMPILE_STATUS))throw new Error("Error compiling fragment shader!",n.getShaderInfoLog(o));var r=n.createProgram();if(n.attachShader(r,a),n.attachShader(r,o),n.linkProgram(r),!n.getProgramParameter(r,n.LINK_STATUS))throw new Error("Linking error!",n.getProgramInfoLog(r));if(n.validateProgram(r),!n.getProgramParameter(r,n.VALIDATE_STATUS))throw new Error("Validating error!",n.getProgramInfoLog(r));return r},ComponentsPanel.prototype.bindHandlers=function(){var t=this;this._btnAddText.addEventListener("click",function(){t._surface.pushLabel()}),this._btnUpdateTexture.addEventListener("click",function(){t._modelView.setTexture(t._surface.toImage())}),this._fileInput.addEventListener("click",function(t){this.value=""}),this._selectBackground.addEventListener("change",function(){this.value&&(t._surface.setClearColor(this.value),t._surface.render())}),this._fileInput.addEventListener("change",function(e){var n=e.target.files[0],a=new FileReader;a.onload=function(e){var n=e.currentTarget.result,a=new Image;a.src=n,t._surface.pushImage(a)},a.readAsDataURL(n)})},ModelViewPanel.prototype.bindHandlers=function(){var t=this;this._btnZoomIn.addEventListener("click",function(){t._modelView.camera.zoomIn()}),this._btnZoomOut.addEventListener("click",function(){t._modelView.camera.zoomOut()}),this._cupTypeSelect.addEventListener("change",function(){var e=this.value;t._modelView.setModel(t._models[e])})},PreviewPanel.prototype.bindHandlers=function(){var t=this;this._btnToggle.addEventListener("click",function(){t.isShown?t.panel.classList.remove("active"):(t.panel.classList.add("active"),t.requestImage()),t.isShown=!t.isShown})},PreviewPanel.prototype.requestImage=function(){var t=this.modelView.makePreviewImage(),e=this.canvas.getContext("2d");e.fillStyle="#FFF";var n=Storage.get("previewMan"),a=.09,o={x:this.canvas.height/-16,y:this.canvas.height/10};e.fillRect(0,0,this.canvas.width,this.canvas.height);var r=(this.canvas.width-this.canvas.height)/2;e.drawImage(n,r,0,this.canvas.height,this.canvas.height),e.rotate(a),e.drawImage(t,o.x,o.y,t.width,t.height),e.rotate(-a);var i=Storage.get("previewManFront");e.drawImage(i,r,0,this.canvas.height,this.canvas.height)},PropertiesPanel.prototype.bindHandlers=function(){var t=this;this._surface.addSelectEventHandler(function(e){t.setSelected(e)}),this._surface.addDeselectEventHandler(function(){t.setSelected(null)}),this._commonPanel.removeBtn.addEventListener("click",function(e){t._surface.removeSelected(),t._surface.render()}),this._commonPanel.upBtn.addEventListener("click",function(e){t._surface.selectedToForeground(),t._surface.render()}),this._commonPanel.downBtn.addEventListener("click",function(e){t._surface.selectedToBackground(),t._surface.render()}),this._textPanel.textArea.addEventListener("input",function(e){t._selectedElement.setText(this.value),t._surface.render()}),this._textPanel.selectFont.addEventListener("change",function(){t._selectedElement.setFont(this.value),t._surface.render()}),this._textPanel.selectColor.addEventListener("change",function(){t._selectedElement.setColor(this.value),t._surface.render()})},PropertiesPanel.prototype.setSelected=function(t){return this._selectedElement=t,t instanceof UILabelElement?void this.showTextProperties():t instanceof UIImageElement?void this.showImageProperties():void this.showNothingSelectedPanel()},PropertiesPanel.prototype.hideAll=function(){this._textPanel.panel.classList.add("hidden"),this._imagePanel.panel.classList.add("hidden"),this._commonPanel.panel.classList.add("hidden"),this._emptyPanel.classList.add("hidden")},PropertiesPanel.prototype.showTextProperties=function(){this.hideAll(),this._textPanel.textArea.innerHTML=this._selectedElement.getText(),this._textPanel.selectFont.value=this._selectedElement.getFont(),this._textPanel.selectColor.value=this._selectedElement.getColor(),this._textPanel.panel.classList.remove("hidden"),this._commonPanel.panel.classList.remove("hidden")},PropertiesPanel.prototype.showImageProperties=function(){this.hideAll(),this._imagePanel.panel.classList.remove("hidden"),this._commonPanel.panel.classList.remove("hidden")},PropertiesPanel.prototype.showNothingSelectedPanel=function(){this.hideAll(),this._emptyPanel.classList.remove("hidden")},document.addEventListener("DOMContentLoaded",function(){var t=document.getElementById("canvas"),e=new CanvasSurface(t);e.render();var n=new PropertiesPanel(e);n.bindHandlers();var a=document.getElementById("cupCanvas"),o=new ResourceLoader,r=null,i=null,s=new ResourcePreparer(o,[{key:"modelCup1",src:"/models/cup1.json",type:"json"},{key:"modelCup2",src:"/models/cup2.json",type:"json"},{key:"vertexShader",src:"/shaders/fragment.glsl",type:"text"},{key:"fragmentShader",src:"/shaders/vertex.glsl",type:"text"},{key:"initialTexture",src:"/img/logoGrey.jpg",type:"image"},{key:"previewMan",src:"/img/previewMan.jpg",type:"image"},{key:"previewManFront",src:"/img/previewManFront.png",type:"image"}],function(){var t={preserveDrawingBuffer:!0},n=a.getContext("webgl",t);if(n||(n=a.getContext("experimental-webgl",t)),!n)throw alert("Seems like your browser does not support WebGL. Come back later when you update your browser!"),new Error("WebGL support is required!");var o={cup1:new Model(n,Storage.get("modelCup1")),cup2:new Model(n,Storage.get("modelCup2"))};r=new ModelView(a,n,Storage.get("initialTexture"),Storage.get("fragmentShader"),Storage.get("vertexShader")),r.setModel(o.cup1),r.startRender();var s=new ComponentsPanel(e,r);s.bindHandlers();var l=new ModelViewPanel(r,o);l.bindHandlers(),i=new PreviewPanel(r),i.bindHandlers()}),l=document.getElementById("drawingContainer"),u=document.getElementById("cupCanvasContainer"),c=document.getElementById("previewCanvas"),h=function(){var t=e.canvas.width/e.canvas.height,n=l.offsetWidth,o=n/t;e.canvas.width=n,e.canvas.height=o,e.render();var s=a.width/a.height,h=u.offsetWidth,d=h/s;a.width=h,a.height=d,c.width=h,c.height=d,r&&r.updateViewport(),i&&i.requestImage()};h(),window.addEventListener("resize",h),s.startLoading()});